<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>AgriSmart — Alerts</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="insertHeader"></div>
  <main class="container">
    <div class="card">
      <h2>Alerts & Notifications</h2>
      <p class="muted">Stay informed about pests, weather, price and resource alerts</p>
    </div>

    <section style="display:grid;grid-template-columns:2fr 1fr;gap:12px;margin-top:12px">
      <div class="card" id="alertsList"></div>
      <aside class="card">
        <h3>Alert Settings</h3>
        <div style="display:flex;flex-direction:column;gap:10px;margin-top:12px">
          <label><input type="checkbox" id="pestToggle" checked> Pest alerts</label>
          <label><input type="checkbox" id="weatherToggle" checked> Weather alerts</label>
          <label><input type="checkbox" id="priceToggle" checked> Price alerts</label>
        </div>
      </aside>
    </section>
  </main>

  <script src="app.js"></script>
  <script>
    ensureAuth()
    const localDemo = JSON.parse(localStorage.getItem('agri_demo')||'{}')
    function renderAlerts(){
      const container = document.getElementById('alertsList'); container.innerHTML = ''
      (localDemo.alerts||[]).forEach(a=>{
        const el = document.createElement('div'); el.className='card'; el.style.marginBottom='10px'
        el.innerHTML = `<div style="display:flex;align-items:flex-start;gap:12px">
          <div style="font-size:20px">⚠️</div>
          <div style="flex:1"><div style="font-weight:700">${a.title} <span class="muted" style="font-weight:600;margin-left:8px;color:${a.sev==='high'?'#d9534f':a.sev==='med'?'#f0ad4e':'#5cb85c'}">${a.sev}</span></div>
          <div class="muted">${a.text}</div>
          <div class="muted" style="margin-top:8px">${new Date(a.ts).toLocaleString()}</div></div>
          <div><button class="btn" onclick="dismiss(${a.id})">Dismiss</button></div>
        </div>`
        container.appendChild(el)
      })
    }
    renderAlerts()
    function dismiss(id){
      const a = localDemo.alerts || []; localDemo.alerts = a.filter(x=>x.id!==id)
      localStorage.setItem('agri_demo', JSON.stringify(localDemo)); renderAlerts(); toast('Alert dismissed')
    }
  </script>
</body>
</html>
